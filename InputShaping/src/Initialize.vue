<style scoped>
</style>

<template>
	<div>
		<v-row v-if="value">
			<v-col>
				name: {{ value.name }} id: {{ value.id }} date: {{ value.date }}<br>
			</v-col>
		</v-row>

		<v-row>
			<v-col>
				<v-row>
					<v-data-table
						v-model="sessionSelected"
						:headers="sessionTableHeaders"
						:items="sessions"
						:single-select="true"
						item-key="id"
						show-select
					>
						<template v-slot:item.date="{ item }">
								{{ timestampToString(item.date) }}
						</template>
					</v-data-table>
				</v-row>

				<v-row>
					<v-btn color="primary" @click="newSession">
							<v-icon class="mr-2">mdi-plus-outline</v-icon> {{ $t('plugins.inputShaping.new') }}
					</v-btn>
					<v-btn color="primary" @click="loadSession" v-if="false">
							<v-icon class="mr-2">mdi-plus-outline</v-icon> {{ $t('plugins.inputShaping.load') }}
					</v-btn>
					<v-btn color="warning" @click="deleteSession" :disabled="sessionSelected.length == 0">
							<v-icon class="mr-2">mdi-trash-can-outline</v-icon> {{ $t('plugins.inputShaping.delete') }}
					</v-btn>
				</v-row>
			</v-col>
		</v-row>

		</div>
</template>

<script>

'use strict';

import { Session } from './InputShapingSession.js';

export default {
	props: [ 'value' ],
	data() {
		return {
			sessions: [],
			sessionSelected: [],
			sessionTableHeaders: [
          {
            text: 'Id', value: 'id', align: 'start', sortable: true
          },
          { text: 'Name', value: 'name', sortable: true },
          { text: 'Date', value: 'date', sortable: true },
        ],
		};
	},
	computed: {
	},
	methods: {
		newSession() {
			console.log("Created new session");
			let session = new Session();

			this.sessions.push(session);
		},
		loadSession() {
			console.log("TODO load session from storage");
		},
		deleteSession() {
			if (this.sessionSelected.length < 0)
				return;

			console.log("deleting", this.sessionSelected[0].id);
			let index = this.sessions.findIndex((elem) => elem.id === this.sessionSelected[0].id);

			if (index < 0)
				return;

			this.sessions.splice(index, 1);
			this.sessionSelected.splice(0, 1);
		},
		timestampToString(value) {
			let date = new Date(value);

			return date.toLocaleString();
		},
	},
	watch: {
		sessionSelected: function(value) {
			if (value.length > 0)
				this.$emit('input', value[0]);
			else
				this.$emit('input', null);
		}
	},
	mounted() {
	}
}
</script>
